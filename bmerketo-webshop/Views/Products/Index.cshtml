@model CollectionViewmodel

@{
    ViewData["title"] = "Products";
    var categories = await _categoryService.GetAllAsync();
    var tags = await _tagService.GetAllAsync();
    var amountOfPages = Math.Ceiling(Model.RowCount / 32);
    var currentRoute = ViewContext.RouteData.Values["action"]?.ToString();
    var currentCategory = ViewContext.RouteData.Values["category"]?.ToString();
    var currentTag = ViewContext.RouteData.Values["tag"]?.ToString();
}

<div class="product-page">
    <div class="container">
        <div>
            <nav>
                <ul class="link-list">
                    <li>
                        <a asp-action="Index" class="@(currentRoute == "Index" ? "active" : "")">All</a>
                    </li>
                    @foreach (var category in categories)
                    {
                        <li>
                            <a asp-action="ProductsByCategory" asp-route-category="@category.Name" asp-route-page="1"
                               class="@(currentRoute == "ProductsByCategory" && category.Name == currentCategory ? "active" : "")">
                                @category.Name
                            </a>
                        </li>
                    }
                    @foreach (var tag in tags)
                    {
                        <li>
                            <a asp-action="ProductsByTag" asp-route-tag="@tag.Name" asp-route-page="1" class="@(currentRoute == "ProductsByTag" && tag.Name == currentTag ? "active" : "")">
                                @tag.Name
                            </a>
                        </li>
                    }
                </ul>
            </nav>
        </div>
        <div class="filter"></div>
        @if (Model.Products != null && Model.Products.Count > 0)
        {
            <Partial name="/Views/Partials/_ProductCollection.cshtml" />

            <div class="page-button-container">
                @if (Model.Page != 1)
                {
                    // We don't want to show go back arrow if we are on the first page
                    <a asp-route-page="@(Model.Page - 1)"><i class="bi bi-chevron-left"></i></a>
                }
                @for (int i = 1; i <= amountOfPages; i++)
                {
                    if (i == Model.Page)
                    {
                        <a asp-route-page="@i" class="active">@i</a>
                    }
                    else
                    {
                        <a asp-route-page="@i">@i</a>
                    }
                }

                @if (Model.Page != amountOfPages)
                {
                    // We don't want go forward arrow to be visible if we are on the last page
                    <a asp-route-page="@(Model.Page + 1)"><i class="bi bi-chevron-right"></i></a>
                }
            </div>
        }
        else
        {
            <!--THis need styling!!!!-->
            <div>Not found</div>
        }
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var form = document.getElementById("category-form");
            var categoryDropdown = document.getElementById("category-dropdown");

            categoryDropdown.addEventListener("change", function () {
                getUrl(categoryDropdown.value, "category")
            });

            function getUrl(selectedOption, type) {
                var baseUrl = "/products/";
                var actionUrl = baseUrl + type + "/" + selectedOption;
                form.action = actionUrl;
                form.submit();
            }
        });
    </script>
</div>